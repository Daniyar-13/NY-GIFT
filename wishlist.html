<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Wish-list</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    html,body{
      margin:0;padding:0;min-height:100vh;
      font-family:'Montserrat',Arial,sans-serif;
      background:url('images/april-bg.jpg') no-repeat center center fixed;
      background-size:cover;
      overflow:hidden;position:relative;
      opacity:1;transition:opacity .45s cubic-bezier(.44,1.07,.69,.93);
    }
    body.fadeout{opacity:0;pointer-events:none;}
    body::before{
      content:'';position:fixed;top:0;left:0;width:100%;height:100%;
      background:linear-gradient(180deg,rgba(230,252,245,.5)0%,rgba(255,250,240,.55)50%,rgba(230,248,255,.45)100%);
      z-index:0;pointer-events:none;
    }
    .page-wrapper{position:relative;z-index:5;min-height:100vh;display:flex;flex-direction:column;align-items:center;}
    .month-title{
      margin:52px 0 10px;text-align:center;
      font-family:'Playfair Display',serif;font-weight:700;
      font-size:2.4rem;color:#22577a;letter-spacing:2px;
      text-shadow:0 3px 16px #fff9,0 4px 24px rgba(120,180,210,.55);
    }
    .month-sub{
      text-align:center;font-size:1rem;color:#457b9d;
      margin-bottom:32px;font-style:italic;
    }
    /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
    .wishlist-card{
      max-width:600px;width:92vw;
      background:rgba(255,255,255,0.97);
      border-radius:30px;
      border:3px solid #b7f0c5;
      padding:28px 24px 22px;
      box-shadow:0 16px 40px rgba(88,129,87,.28);
      backdrop-filter:blur(8px);
      position:relative;
      display:flex;flex-direction:column;
    }
    .wishlist-header{
      text-align:center;margin-bottom:18px;
    }
    .wishlist-header h2{
      font-family:'Playfair Display',serif;
      font-size:2rem;color:#2d6a4f;margin:0 0 10px;
      letter-spacing:1px;
    }
    .wishlist-header p{
      margin:0;font-size:.98rem;color:#52796f;
    }
    .wish-list{
      list-style:none;margin:16px 0 6px;padding:0;
      max-height:44vh;overflow-y:auto;
    }
    .wish-item{
      display:flex;align-items:center;
      background:rgba(240,252,245,0.95);
      border-radius:18px;
      padding:9px 12px;
      margin-bottom:8px;
      box-shadow:0 3px 12px rgba(128,237,153,.25);
      transition:transform .16s,box-shadow .16s,background .16s;
    }
    .wish-item:hover{
      transform:translateY(-2px);
      box-shadow:0 5px 16px rgba(128,237,153,.40);
      background:rgba(232,252,244,0.98);
    }
    .wish-text{
      flex:1;border:none;background:transparent;
      font-size:.98rem;color:#264653;
      outline:none;
    }
    .wish-text::placeholder{color:#b0c4c5;}
    .wish-item.completed{
      background:rgba(224,247,230,0.85);opacity:.85;
    }
    .wish-item.completed .wish-text{
      text-decoration:line-through;color:#6c757d;
    }
    .wish-item.completed::after{
      content:'‚úì';margin-left:6px;font-size:.9rem;color:#2d6a4f;
    }
    .bottom-row{
      display:flex;align-items:center;justify-content:space-between;
      margin-top:10px;
    }
    .hint-text{
      font-size:.85rem;color:#74c69d;font-style:italic;
    }
    .btn-add{
      border:none;border-radius:20px;
      padding:9px 18px;
      font-size:.9rem;font-weight:600;
      font-family:'Montserrat',Arial,sans-serif;
      cursor:pointer;
      background:linear-gradient(135deg,#52b788,#80ed99);
      color:#fff;box-shadow:0 4px 14px rgba(82,183,136,.55);
      transition:transform .14s,box-shadow .14s,background .14s;
      display:flex;align-items:center;gap:6px;
    }
    .btn-add span{font-size:1.2rem;}
    .btn-add:hover{
      transform:translateY(-1px) scale(1.02);
      box-shadow:0 6px 18px rgba(82,183,136,.7);
      background:linear-gradient(135deg,#40916c,#80ed99);
    }
    /* –õ–µ—Ç–∞—é—â–∏–µ –Ω–æ–º–µ—Ä–∞ –∂–µ–ª–∞–Ω–∏–π */
    .wish-number{
      position:fixed;
      font-family:'Playfair Display',serif;
      font-weight:700;
      font-size:2.3rem;
      color:#2d6a4f;
      text-shadow:0 4px 12px rgba(0,0,0,.25);
      opacity:0;
      transform:scale(0.4);
      z-index:8;
      pointer-events:none;
      animation:numberPop 2.4s ease-out forwards;
    }
    .wish-number.left{left:4%;top:18%;}
    .wish-number.right{right:5%;bottom:18%;}
    @keyframes numberPop{
      0%{opacity:0;transform:translateY(10px) scale(.4);}
      20%{opacity:1;transform:translateY(0) scale(1);}
      60%{transform:translateY(-10px) scale(1.05);}
      100%{opacity:.8;transform:translateY(0) scale(1);}
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    .nav-btn{
      position:fixed;bottom:26px;width:52px;height:52px;
      background:rgba(255,255,255,0.98);border:2px solid #80ed99;
      border-radius:50%;box-shadow:0 5px 17px rgba(76,175,80,.23);
      display:flex;align-items:center;justify-content:center;
      font-size:2rem;font-weight:bold;color:#2d6a4f;
      cursor:pointer;z-index:100;text-decoration:none;
      transition:background .16s,transform .14s;
    }
    .nav-btn.left{left:26px;}
    .nav-btn.right{right:26px;background:#d8f3dc;}
    .nav-btn:hover{background:#c7f9cc;transform:scale(1.07);}

    @media(max-width:800px){
      .month-title{font-size:1.4rem;margin-top:40px;}
      .wishlist-card{padding:20px 16px;}
    }
  </style>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // –ü–õ–ê–í–ù–´–ô –ü–ï–†–ï–•–û–î –ú–ï–ñ–î–£ –°–¢–†–ê–ù–ò–¶–ê–ú–ò
    window.addEventListener('DOMContentLoaded',()=>{setTimeout(()=>{document.body.style.opacity=1;},50);});
    function pageTransition(href){
      document.body.classList.add('fadeout');
      setTimeout(()=>{window.location.href=href;},380);
    }

    // –ù–ê–°–¢–†–û–ô–ö–ê SUPABASE (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è)
    const SUPABASE_URL = 'https://YOUR-PROJECT.supabase.co';
    const SUPABASE_KEY = 'YOUR_ANON_PUBLIC_KEY';

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // user_id –º–æ–∂–µ—à—å –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –ø–æ–¥ –Ω–µ—ë (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)
    const WISH_USER_ID = 'user_april_01';
  </script>
</head>
<body style="opacity:0">
  <div class="page-wrapper">
    <h1 class="month-title">Wish-list —Ç–≤–æ–∏—Ö –∂–µ–ª–∞–Ω–∏–π üåà</h1>
    <p class="month-sub">–î–æ–±–∞–≤–ª—è–π —Å—é–¥–∞ –≤—Å—ë, —á—Ç–æ —Ö–æ—á–µ—Ç—Å—è ‚Äî —è –±—É–¥—É –∑–∞–≥–ª—è–¥—ã–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª–Ω—è—Ç—å –ø–æ –æ–¥–Ω–æ–º—É –ø—É–Ω–∫—Ç—É ‚ú®</p>

    <div class="wishlist-card">
      <div class="wishlist-header">
        <h2>–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π</h2>
        <p>–ü–∏—à–∏ —Å—é–¥–∞ –ø–æ–¥–∞—Ä–∫–∏, –ø–æ–µ–∑–¥–∫–∏, –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è, –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å.</p>
      </div>

      <ul class="wish-list" id="wishList"></ul>

      <div class="bottom-row">
        <span class="hint-text">–ú–æ–∂–µ—à—å –¥–æ–±–∞–≤–ª—è—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ –ø—É–Ω–∫—Ç–æ–≤ ‚Äî —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–ª—å–∫–æ —Ç–≤–æ–π üíö</span>
        <button class="btn-add" id="addWishBtn"><span>+</span> –∂–µ–ª–∞–Ω–∏–µ</button>
      </div>
    </div>
  </div>

  <button class="nav-btn left"  onclick="pageTransition('birthday.html')" title="–ù–∞–∑–∞–¥">&#8592;</button>
  <button class="nav-btn right" onclick="pageTransition('star.html')"   title="STAR">S</button>

  <script>
    const wishListEl = document.getElementById('wishList');
    const addBtn     = document.getElementById('addWishBtn');
    let wishCounter  = 0; // –¥–ª—è –Ω–æ–º–µ—Ä–æ–≤ 1,2,3‚Ä¶

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∂–µ–ª–∞–Ω–∏—è –∏–∑ Supabase
    async function loadWishes(){
      const { data, error } = await supabaseClient
        .from('wishes')
        .select('*')
        .eq('user_id', WISH_USER_ID)
        .order('id', { ascending: true });

      if(error){
        console.error('load error', error);
        return;
      }
      wishListEl.innerHTML = '';
      wishCounter = 0;
      data.forEach(row => {
        addWishRow(row.id, row.text, row.done, false); // –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
      });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ DOM-—ç–ª–µ–º–µ–Ω—Ç–∞ –∂–µ–ª–∞–Ω–∏—è
    function addWishRow(id, text='', done=false, withNumber=true){
      wishCounter++;
      const li = document.createElement('li');
      li.className = 'wish-item';
      if(done) li.classList.add('completed');
      li.dataset.id = id ?? ''; // –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

      li.innerHTML = `
        <input type="checkbox" ${done ? 'checked' : ''}>
        <input class="wish-text" type="text" placeholder="–ï—â—ë –æ–¥–Ω–æ –∂–µ–ª–∞–Ω–∏–µ‚Ä¶" value="${text ? text.replace(/"/g,'&quot;') : ''}">
      `;
      wishListEl.appendChild(li);

      if(withNumber){
        spawnWishNumber(wishCounter);
      }
    }

    // –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø—É–ª—å—Å–∏—Ä—É—é—â–µ–π —Ü–∏—Ñ—Ä—ã —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞
    function spawnWishNumber(num){
      const span = document.createElement('span');
      span.className = 'wish-number ' + (num % 2 === 0 ? 'right' : 'left');
      span.textContent = num;
      document.body.appendChild(span);
      // –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å, –æ–Ω —Å–∞–º –∏—Å—á–µ–∑–∞—Ç—å –Ω–µ –¥–æ–ª–∂–µ–Ω ‚Äî –º—è–≥–∫–∞—è "–Ω–∞–∫–ª–µ–π–∫–∞" –Ω–æ–º–µ—Ä–∞
      setTimeout(()=>{ span.style.opacity = '0.85'; }, 2400);
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∂–µ–ª–∞–Ω–∏—è (—Å—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –≤ Supabase)
    addBtn.addEventListener('click', async ()=>{
      // –≤—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–µ –∂–µ–ª–∞–Ω–∏–µ –≤ –ë–î
      const { data, error } = await supabaseClient
        .from('wishes')
        .insert({ user_id: WISH_USER_ID, text: '', done: false })
        .select()
        .single();

      if(error){
        console.error('insert error', error);
        return;
      }
      addWishRow(data.id, '', false, true);
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–∞ –∏ —Ñ–ª–∞–≥–∞ done
    wishListEl.addEventListener('input', async (e)=>{
      if(!e.target.classList.contains('wish-text')) return;
      const li   = e.target.closest('.wish-item');
      const id   = li.dataset.id;
      const text = e.target.value;

      if(!id){ return; } // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π

      const { error } = await supabaseClient
        .from('wishes')
        .update({ text })
        .eq('id', id);

      if(error) console.error('update text error', error);
    });

    wishListEl.addEventListener('change', async (e)=>{
      if(e.target.type !== 'checkbox') return;
      const li   = e.target.closest('.wish-item');
      const id   = li.dataset.id;
      const done = e.target.checked;

      li.classList.toggle('completed', done);

      if(!id){ return; }

      const { error } = await supabaseClient
        .from('wishes')
        .update({ done })
        .eq('id', id);

      if(error) console.error('update done error', error);
    });

    // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    loadWishes();
  </script>
</body>
</html>
