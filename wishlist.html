<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Wish-list</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    html,body{
      margin:0;padding:0;min-height:100vh;
      font-family:'Montserrat',Arial,sans-serif;
      background:url('images/march.png') no-repeat center center fixed;
      background-size:cover;
      overflow:hidden;position:relative;
      opacity:1;transition:opacity .45s cubic-bezier(.44,1.07,.69,.93);
    }
    body.fadeout{opacity:0;pointer-events:none;}
    body::before{
      content:'';position:fixed;top:0;left:0;width:100%;height:100%;
      background:linear-gradient(180deg,rgba(230,252,245,.5)0%,rgba(255,250,240,.55)50%,rgba(230,248,255,.45)100%);
      z-index:0;pointer-events:none;
    }
    .page-wrapper{position:relative;z-index:5;min-height:100vh;display:flex;flex-direction:column;align-items:center;}
    .month-title{
      margin:52px 0 10px;text-align:center;
      font-family:'Playfair Display',serif;font-weight:700;
      font-size:2.4rem;color:#22577a;letter-spacing:2px;
      text-shadow:0 3px 16px #fff9,0 4px 24px rgba(120,180,210,.55);
    }
    .month-sub{
      text-align:center;font-size:1rem;color:#457b9d;
      margin-bottom:32px;font-style:italic;
    }
    /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
    .wishlist-card{
      max-width:600px;width:92vw;
      background:rgba(255,255,255,0.97);
      border-radius:30px;
      border:3px solid #b7f0c5;
      padding:28px 24px 22px;
      box-shadow:0 16px 40px rgba(88,129,87,.28);
      backdrop-filter:blur(8px);
      position:relative;
      display:flex;flex-direction:column;
    }
    .wishlist-header{
      text-align:center;margin-bottom:18px;
    }
    .wishlist-header h2{
      font-family:'Playfair Display',serif;
      font-size:2rem;color:#2d6a4f;margin:0 0 10px;
      letter-spacing:1px;
    }
    .wishlist-header p{
      margin:0;font-size:.98rem;color:#52796f;
    }
    .wish-list{
      list-style:none;margin:16px 0 6px;padding:0;
      max-height:44vh;overflow-y:auto;
    }
    .wish-item{
      display:flex;align-items:center;
      background:rgba(240,252,245,0.95);
      border-radius:18px;
      padding:9px 12px;
      margin-bottom:8px;
      box-shadow:0 3px 12px rgba(128,237,153,.25);
      transition:transform .16s,box-shadow .16s,background .16s;
    }
    .wish-item:hover{
      transform:translateY(-2px);
      box-shadow:0 5px 16px rgba(128,237,153,.40);
      background:rgba(232,252,244,0.98);
    }
    .wish-text{
      flex:1;border:none;background:transparent;
      font-size:.98rem;color:#264653;
      outline:none;
    }
    .wish-text::placeholder{color:#b0c4c5;}
    .wish-item.completed{
      background:rgba(224,247,230,0.85);opacity:.85;
    }
    .wish-item.completed .wish-text{
      text-decoration:line-through;color:#6c757d;
    }
    .wish-item.completed::after{
      content:'‚úì';margin-left:6px;font-size:.9rem;color:#2d6a4f;
    }
    .bottom-row{
      display:flex;align-items:center;justify-content:space-between;
      margin-top:10px;
    }
    .hint-text{
      font-size:.85rem;color:#74c69d;font-style:italic;
    }
    .btn-add{
      border:none;border-radius:20px;
      padding:9px 18px;
      font-size:.9rem;font-weight:600;
      font-family:'Montserrat',Arial,sans-serif;
      cursor:pointer;
      background:linear-gradient(135deg,#52b788,#80ed99);
      color:#fff;box-shadow:0 4px 14px rgba(82,183,136,.55);
      transition:transform .14s,box-shadow .14s,background .14s;
      display:flex;align-items:center;gap:6px;
    }
    .btn-add span{font-size:1.2rem;}
    .btn-add:hover{
      transform:translateY(-1px) scale(1.02);
      box-shadow:0 6px 18px rgba(82,183,136,.7);
      background:linear-gradient(135deg,#40916c,#80ed99);
    }
    /* –õ–µ—Ç–∞—é—â–∏–µ –Ω–æ–º–µ—Ä–∞ –∂–µ–ª–∞–Ω–∏–π */
    .wish-number{
      position:fixed;
      font-family:'Playfair Display',serif;
      font-weight:700;
      font-size:2.3rem;
      color:#2d6a4f;
      text-shadow:0 4px 12px rgba(0,0,0,.25);
      opacity:0;
      transform:scale(0.4);
      z-index:8;
      pointer-events:none;
      animation:numberPop 2.4s ease-out forwards;
    }
    .wish-number.left{left:4%;top:18%;}
    .wish-number.right{right:5%;bottom:18%;}
    @keyframes numberPop{
      0%{opacity:0;transform:translateY(10px) scale(.4);}
      20%{opacity:1;transform:translateY(0) scale(1);}
      60%{transform:translateY(-10px) scale(1.05);}
      100%{opacity:.8;transform:translateY(0) scale(1);}
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    .nav-btn{
      position:fixed;bottom:26px;width:52px;height:52px;
      background:rgba(255,255,255,0.98);border:2px solid #80ed99;
      border-radius:50%;box-shadow:0 5px 17px rgba(76,175,80,.23);
      display:flex;align-items:center;justify-content:center;
      font-size:2rem;font-weight:bold;color:#2d6a4f;
      cursor:pointer;z-index:100;text-decoration:none;
      transition:background .16s,transform .14s;
    }
    .nav-btn.left{left:26px;}
    .nav-btn.right{right:26px;background:#d8f3dc;}
    .nav-btn:hover{background:#c7f9cc;transform:scale(1.07);}

    @media(max-width:800px){
      .month-title{font-size:1.4rem;margin-top:40px;}
      .wishlist-card{padding:20px 16px;}
    }

    /* ===== –ú–û–î–ê–õ–ö–ê ===== */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.35);
      display:none;
      justify-content:center;
      align-items:center;
      padding:16px;
      z-index:200;
    }
    .modal{
      width:100%;
      max-width:420px;
      background:#ffffff;
      border-radius:16px;
      padding:18px 16px 16px;
      box-shadow:0 12px 28px rgba(0,0,0,.25);
    }
    .modal h2{
      margin:0 0 10px;
      font-size:1.1rem;
    }
    .field{
      margin-bottom:10px;
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:.85rem;
    }
    textarea{
      resize:vertical;
      min-height:70px;
      padding:8px;
      border-radius:10px;
      border:1px solid #cfd8dc;
      font-family:inherit;
      font-size:.95rem;
    }
    input[type="file"]{
      font-size:.85rem;
    }
    .modal-actions{
      margin-top:12px;
      display:flex;
      justify-content:flex-end;
      gap:8px;
    }
    .btn{
      border:none;
      border-radius:999px;
      padding:7px 14px;
      font-size:.9rem;
      cursor:pointer;
    }
    .btn-secondary{
      background:#eceff1;
      color:#37474f;
    }
    .btn-primary{
      background:#47c98a;
      color:#fff;
    }
  </style>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // –ü–õ–ê–í–ù–´–ô –ü–ï–†–ï–•–û–î
    window.addEventListener('DOMContentLoaded',()=>{setTimeout(()=>{document.body.style.opacity=1;},50);});
    function pageTransition(href){
      document.body.classList.add('fadeout');
      setTimeout(()=>{window.location.href=href;},380);
    }

    // –ù–ê–°–¢–†–û–ô–ö–ê SUPABASE
    const SUPABASE_URL = 'https://grdqiirmkldrgswpilqf.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdyZHFpaXJta2xkcmdzd3BpbHFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMjIxNjMsImV4cCI6MjA3ODc5ODE2M30.yTl2hdqvEBIvV6txQ7nYjw_mJj15KtQADImnWXndZpA';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  function getOrCreateRandomUserId() {
  let id = localStorage.getItem('user_id');
  if (!id) {
    id = Math.floor(Math.random() * 1000) + 1; // 1..1000, –Ω–µ 0
    localStorage.setItem('user_id', String(id));
  }
  return Number(id);
}

const WISH_USER_ID = getOrCreateRandomUserId();
  </script>
</head>
<body style="opacity:0">
  <div class="page-wrapper">
    <h1 class="month-title">Your personal wishlist üåà</h1>
    <p class="month-sub">–î–æ–±–∞–≤–ª—è–π —Å—é–¥–∞ –≤—Å—ë —á—Ç–æ –∑–∞—Ö–æ—á–µ—à—å ‚Äî —è –∂–µ –±—É–¥—É –≤—ã–ø–æ–ª–Ω—è—Ç—å —ç—Ç–æ ‚ú®</p>

    <div class="wishlist-card">
      <div class="wishlist-header">
        <h2>–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π</h2>
        <p>–ü–∏—à–∏ —Å—é–¥–∞ –≤—Å–µ —á—Ç–æ —Ö–æ—á–µ—à—å: –ø–æ–¥–∞—Ä–∫–∏, –ø–æ–µ–∑–¥–∫–∏, –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è, –≤–µ—â–∏, –≤—Å–µ —á—Ç–æ —Ö–æ—á–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å.</p>
      </div>

      <ul class="wish-list" id="wishList"></ul>

      <div class="bottom-row">
        <span class="hint-text">–ú–æ–∂–µ—à—å –¥–æ–±–∞–≤–ª—è—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ –ø—É–Ω–∫—Ç–æ–≤ ‚Äî —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–ª—å–∫–æ —Ç–≤–æ–π üíö</span>
        <button class="btn-add" id="addWishBtn"><span>+</span> –∂–µ–ª–∞–Ω–∏–µ</button>
      </div>
    </div>
  </div>

  <button class="nav-btn left"  onclick="pageTransition('birthday.html')" title="–ù–∞–∑–∞–¥">&#8592;</button>
  <button class="nav-btn right" onclick="pageTransition('star.html')"   title="STAR">S</button>

  <!-- –ú–û–î–ê–õ–ö–ê -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <h2>–ù–æ–≤–æ–µ –∂–µ–ª–∞–Ω–∏–µ</h2>
      <div class="field">
        <label for="wishTextModal">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea id="wishTextModal" placeholder="–ù–∞–ø–∏—à–∏, —á–µ–≥–æ —Ö–æ—á–µ—Ç—Å—è‚Ä¶"></textarea>
      </div>
      <div class="field">
        <label for="wishImage">–ö–∞—Ä—Ç–∏–Ω–∫–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</label>
        <input type="file" id="wishImage" accept="image/*">
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    const wishListEl = document.getElementById('wishList');
    const addBtn     = document.getElementById('addWishBtn');
    let   wishCounter = 0;

    const modalBackdrop = document.getElementById('modalBackdrop');
    const wishTextModal = document.getElementById('wishTextModal');
    const wishImageEl   = document.getElementById('wishImage');
    const cancelBtn     = document.getElementById('cancelBtn');
    const saveBtn       = document.getElementById('saveBtn');

    function openModal(){
      modalBackdrop.style.display = 'flex';
    }
    function closeModal(){
      modalBackdrop.style.display = 'none';
      wishTextModal.value = '';
      wishImageEl.value = '';
    }

    addBtn.addEventListener('click', openModal);
    cancelBtn.addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click',(e)=>{
      if(e.target === modalBackdrop) closeModal();
    });

 

    function addWishRow(id, text='', done=false, withNumber=true){
      wishCounter++;
      const li = document.createElement('li');
      li.className = 'wish-item';
      if(done) li.classList.add('completed');
      li.dataset.id = id ?? '';
}

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∂–µ–ª–∞–Ω–∏—è (—Ç–µ–∫—Å—Ç + –∫–∞—Ä—Ç–∏–Ω–∫–∞)
    async function saveWish(){
      const text = wishTextModal.value.trim();
      const file = wishImageEl.files[0];

      if(!text && !file){
        alert('–î–æ–±–∞–≤—å —Ö–æ—Ç—è –±—ã —Ç–µ–∫—Å—Ç –∏–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É :)');
        return;
      }

      let imageUrl = null;

      if(file){
        const fileName = `${Date.now()}-${file.name}`;
        const { data: uploadData, error: uploadError } = await supabaseClient
          .storage
          .from('wishlist')        // bucket "wishlist"
          .upload(fileName, file);

        if(uploadError){
          console.error(uploadError);
          alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏');
          return;
        }

        const { data: publicUrlData } = supabaseClient
          .storage
          .from('wishlist')
          .getPublicUrl(uploadData.path);

        imageUrl = publicUrlData.publicUrl;
      }

      const { data, error: insertError } = await supabaseClient
        .from('wishlist')
        .insert({
          user_id: WISH_USER_ID,
          text: text,
          done: false,
          image_url: imageUrl
        })
        .select()
        .single();

     if (insertError) {
  console.log(insertError);      // —É–∂–µ –µ—Å—Ç—å
  alert(insertError.message);    // ‚Üê –¥–æ–±–∞–≤—å
  return;
}

      addWishRow(data.id, data.text, data.done, true);
      closeModal();
    }

    saveBtn.addEventListener('click', saveWish);

    
  </script>
</body>
</html>

